<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmMsed0zPFAgZoiy8oORF6kZTurpIrdg0&callback=initMap">
</script>
<script>

function initMap(){
  x = navigator.geolocation;
  x.getCurrentPosition(success, failure);

  function success(position){
    var userLat, userLong;
    userLat = position.coords.latitude;
    userLong = position.coords.longitude;
    
    var coords = new google.maps.LatLng(userLat,userLong);
    
    document.getElementById("userLat").value = userLat;
    document.getElementById("userLng").value = userLong;
    
    var mapOptions = {
      zoom: 11,
      center: coords,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    
    var map = new google.maps.Map(document.getElementById("map"), mapOptions);
    var user = new google.maps.Marker({map:map, draggable: true, animation: google.maps.Animation.DROP, position:coords})
    user.addListener('click', toggleBounce);
    
    
    var image = {
      url: 'https://lh3.googleusercontent.com/qib447aK25hGM1wSNa6xPEa4qiPJX0Dqa8CHCltVhi_ETjGeZdSYaY6GMAiLT4QOsaA', 
      scaledSize: new google.maps.Size(30, 30)
    };
    
    //console.log(gon.vehicles[0].location_id);
    
    var arr = [];
    for (var i = 0; i < gon.vehicles.length; i++) {
      for(var j = 0; j < gon.locations.length; j++){
        
        if(gon.vehicles[i].location_id == gon.locations[j].id){
            // console.log(parseFloat(gon.locations[j].latitude));
            arr.push(
                new google.maps.Marker({
                  position: {lat: parseFloat(gon.locations[j].latitude), lng: parseFloat(gon.locations[j].longitude)},
                  map: map,
                  icon: image,
                  url: 'locations/'+gon.locations[j].id
                })
              );
              
          google.maps.event.addListener(arr[i], 'click', function() {
              window.location.href = this.url;
          });

        }
       
        
      }
    }
    
    
    // var stateLibary = new google.maps.Marker({
    //   position: {lat: -37.809800, lng: 144.965200},
    //   map: map,
    //   icon: image,
    //   url: 'locations/1'
    // });
    
    // google.maps.event.addListener(stateLibary, 'click', function() {
    //     window.location.href = this.url;
    // });
    
    
    // var flinderS = new google.maps.Marker({
    //   position: {lat: -37.818300, lng: 144.967100},
    //   map: map,
    //   icon: image,
    //   url: 'locations/2'
    // });
    
    // google.maps.event.addListener(flinderS, 'click', function() {
    //     window.location.href = this.url;
    // }); 
    
    // var melCentral = new google.maps.Marker({
    //   position: {lat: -37.810200, lng: 144.962800},
    //   map: map,
    //   icon: image,
    //   url: 'locations/3'
    // });
    
    // google.maps.event.addListener(melCentral, 'click', function() {
    //     window.location.href = this.url;
    // });  
    
    
    function toggleBounce() {
      if (user.getAnimation() !== null) {
        user.setAnimation(null);
      } else {
        user.setAnimation(google.maps.Animation.BOUNCE);
      }
    }
    
    
  }
  
  function failure(){
    alert('Google Map has some problem!');
  }
  
}

    
    
    

// google.maps.event.addDomListener(window, 'load', initialize);
</script>
